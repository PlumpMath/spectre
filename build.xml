<project name="spectre" default="dist" basedir=".">
    <property name="spectre-dir" location="./aspectSerializer"/>
    <property name="spectre-jar" location="${spectre-dir}/target/spectre-1.0-jar-with-dependencies.jar"/>
    <property name="cgen-dir" location="./_codegen"/>
    <property name="cgen-jar" location="${cgen-dir}/target/aspect-code-generator-1.0-jar-with-dependencies.jar"/>

    <target name="init">
        <tstamp/>
    </target>

    <!-- ======================================== -->
    <!-- _codegen                                 -->
    <!-- ======================================== -->
    <target name="is-code-gen-built">
        <condition property="codeGenJarExists">
            <available file="${cgen-jar}"/>
        </condition>
    </target>

    <target name="code-gen-compile" depends="is-code-gen-built" unless="codeGenJarExists">
        <exec executable="mvn" dir="${cgen-dir}">
            <arg value="package"/>
        </exec>
    </target>

    <target name="generate-code" depends="code-gen-compile">
        <java jar="${cgen-jar}" fork="true" failonerror="true"/>
    </target>

    <target name="cgen-clean">
        <exec executable="mvn" dir="${cgen-dir}">
            <arg value="clean"/>
        </exec>
    </target>

    <!-- ======================================== -->
    <!-- aspectSerializer                         -->
    <!-- ======================================== -->
    <target name="spectre-build" depends="init,code-gen">
        <exec executable="mvn" dir="${spectre-dir}">
            <arg value="compile"/>
        </exec>
    </target>

    <target name="spectre-clean">
        <exec executable="mvn" dir="${spectre-dir}">
            <arg value="clean"/>
        </exec>
    </target>

    <!-- ======================================== -->
    <!-- global                                   -->
    <!-- ======================================== -->
    <target name="dist" depends="compile">
        <exec executable="mvn" dir="${spectre-dir}">
            <arg value="package"/>
        </exec>
    </target>

    <target name="clean">
        <exec executable="mvn" dir="${cgen-dir}">
            <arg value="clean"/>
        </exec>
        <exec executable="mvn" dir="${spectre-dir}">
            <arg value="clean"/>
        </exec>
    </target>

    <target name="test">
        <exec executable="mvn" dir="${cgen-dir}">
            <arg value="test"/>
        </exec>
        <exec executable="mvn" dir="${spectre-dir}">
            <arg value="test"/>
        </exec>
    </target>

    <target name="write-test" depends="dist">
        <java classname="skadistats.WritePosition" classpath="${spectre-jar}" failonerror="true"/>
    </target>
</project>
